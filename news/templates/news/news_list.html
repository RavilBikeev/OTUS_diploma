{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="flex flex-col lg:flex-row gap-8 p-6">

  <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —Ç–µ–≥–∞–º–∏ -->
  <div class="md:col-span-1">
    <div class="bg-white rounded-2xl shadow p-4 space-y-6">
      <form method="get" action="">
        <label for="search" class="block text-sm font-medium text-gray-700">–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–≤–æ—Å—Ç—è–º</label>
        <input type="text" name="q" id="search" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..." value="{{ query }}"
               class="border border-gray-300 rounded px-4 py-2 w-full mt-2" />
        {% if current_tag_id %}
          <input type="hidden" name="tag" value="{{ current_tag_id }}">
        {% endif %}
        <button type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded w-full mt-3 hover:bg-blue-700 transition">
          –ù–∞–π—Ç–∏
        </button>
      </form>

      <div>
        <h2 class="text-xl font-semibold mb-4">–¢–µ–≥–∏</h2>
        <div class="flex flex-wrap gap-2">
          <a href="{% url 'news:list' %}"
             class="px-3 py-1 rounded-full text-sm border {% if not current_tag_id %}bg-blue-100 text-blue-700 border-blue-300{% else %}bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200{% endif %}">
             –í—Å–µ —Ç–µ–≥–∏
          </a>
          {% for tag in tags %}
            <a href="?tag={{ tag.id }}"
               class="px-3 py-1 rounded-full text-sm border {% if current_tag_id == tag.id|stringformat:'s' %}bg-blue-100 text-blue-700 border-blue-300{% else %}bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200{% endif %}">
               {{ tag.name }}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏ -->
  <div class="lg:w-3/4 w-full">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold">–ù–æ–≤–æ—Å—Ç–∏</h1>
      {% if user.is_authenticated and user.role in "admin hr manager" %}
        <a href="{% url 'news:create' %}" class="flex items-center gap-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm shadow">
          <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å
        </a>
      {% endif %}
    </div>

    <!-- –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
    <div class="grid md:grid-cols-2 gap-6">
      {% for news in news_list %}
        <div class="bg-white p-6 rounded-2xl shadow flex flex-col justify-between h-full">
          <div>
            <h2 class="text-xl font-semibold text-blue-700 hover:underline">
              <a href="{% url 'news:detail' news.pk %}">{{ news.title }}</a>
            </h2>
            <p class="text-sm text-gray-500 mt-1">{{ news.created_at|date:"d.m.Y H:i" }} ‚Äî {{ news.author.employee.department.name|default:"" }}</p>
            <p class="mt-3 text-gray-800">{{ news.content|truncatewords:20 }}</p>
            <!-- –¢–µ–≥–∏ -->
            <div class="mt-4 flex flex-wrap gap-2">
              {% for tag in news.tags.all %}
                <span class="px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-700 border border-blue-300">{{ tag.name }}</span>
              {% endfor %}
            </div>
          </div>
          <div class="mt-4 flex justify-between items-center text-sm text-gray-600">
            <!-- –õ–∞–π–∫–∏ -->
            <form method="post" action="{% url 'news:like_news' news.pk %}" class="like-form flex items-center gap-1" data-news-id="{{ news.pk }}">
              {% csrf_token %}
              <button type="submit" class="flex items-center gap-1 text-red-500 hover:text-red-600">
                ‚ù§Ô∏è
                <span class="like-count">{{ news.likes.count }}</span>
              </button>
            </form>

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
            <div class="flex items-center gap-1 text-gray-500">
              üí¨
              <span>{{ news.comments.count }}</span>
            </div>

            <!-- –ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
            <div class="flex items-center gap-3">
              <a href="{% url 'news:detail' news.pk %}" class="text-blue-600 hover:underline">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</a>
              {% if user.is_authenticated and user.role in "admin hr manager" %}
                <a href="{% url 'news:edit' news.pk %}" class="text-gray-400 hover:text-gray-600">‚úèÔ∏è</a>
              {% endif %}
            </div>
          </div>
        </div>
      {% empty %}
        <p>–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
